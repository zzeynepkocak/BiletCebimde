@model IEnumerable<BiletCebimde.ViewModels.EventViewModel>

@{
    ViewData["Title"] = "Etkinlikler";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Etkinlikler</h2>
        @if (User.IsInRole("Admin") || User.IsInRole("Organizer"))
        {
            <a asp-action="Create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Yeni Etkinlik Oluştur
            </a>
        }
    </div>

    <!-- Filtreleme ve Arama Formu -->
    <div class="card mb-4">
        <div class="card-body">
            <form asp-action="Index" method="get" class="row g-3">
                <div class="col-md-4">
                    <label for="searchString" class="form-label">Ara</label>
                    <input type="text" 
                           class="form-control" 
                           id="searchString" 
                           name="searchString" 
                           value="@(ViewBag.SearchString ?? string.Empty)" 
                           placeholder="Etkinlik adı veya açıklama ara...">
                </div>
                <div class="col-md-4">
                    <label for="categoryId" class="form-label">Kategori</label>
                    <select class="form-select" 
                            id="categoryId" 
                            name="categoryId">
                        <option value="">Tüm Kategoriler</option>
                        @if (ViewBag.Categories != null)
                        {
                            @foreach (var category in ViewBag.Categories as List<BiletCebimde.ViewModels.CategoryViewModel>)
                            {
                                var isSelected = ViewBag.CategoryId != null && ViewBag.CategoryId == category.Id;
                                <option value="@category.Id" selected="@isSelected">
                                    @category.Name
                                </option>
                            }
                        }
                    </select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-outline-primary me-2">
                        <i class="bi bi-search"></i> Filtrele
                    </button>
                    <a asp-action="Index" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Temizle
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Etkinlik Listesi -->
    @if (Model != null && Model.Any())
    {
        <div class="row">
            @foreach (var item in Model)
            {
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body d-flex flex-column">
                            <div class="mb-2">
                                <span class="badge bg-info text-dark">@item.CategoryName</span>
                                @if (item.RegisteredCount >= item.Capacity)
                                {
                                    <span class="badge bg-danger">Dolu</span>
                                }
                                else if (item.Date < DateTime.Now)
                                {
                                    <span class="badge bg-secondary">Geçmiş</span>
                                }
                                else
                                {
                                    <span class="badge bg-success">Açık</span>
                                }
                            </div>
                            
                            <h5 class="card-title">@item.Title</h5>
                            
                            <p class="card-text text-muted flex-grow-1">
                                @if (item.Description != null && item.Description.Length > 100)
                                {
                                    @item.Description.Substring(0, 100)
                                    <text>...</text>
                                }
                                else
                                {
                                    @item.Description
                                }
                            </p>
                            
                            <div class="mt-auto">
                                <div class="mb-2">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-calendar-event"></i> 
                                        <strong>Tarih:</strong> @item.Date.ToString("dd MMMM yyyy, dddd", new System.Globalization.CultureInfo("tr-TR")) 
                                        @item.Date.ToString("HH:mm")
                                    </small>
                                    <small class="text-muted d-block">
                                        <i class="bi bi-geo-alt"></i> 
                                        <strong>Yer:</strong> @item.VenueName
                                    </small>
                                    <small class="text-muted d-block">
                                        <i class="bi bi-people"></i> 
                                        <strong>Kontenjan:</strong> @item.RegisteredCount / @item.Capacity
                                    </small>
                                    @if (!string.IsNullOrEmpty(item.OrganizerName))
                                    {
                                        <small class="text-muted d-block">
                                            <i class="bi bi-person"></i> 
                                            <strong>Organizatör:</strong> @item.OrganizerName
                                        </small>
                                    }
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-primary btn-sm">
                                        <i class="bi bi-info-circle"></i> Detaylar
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info" role="alert">
            <i class="bi bi-info-circle"></i> 
            Henüz etkinlik bulunmamaktadır.
            @if (User.IsInRole("Admin") || User.IsInRole("Organizer"))
            {
                <a asp-action="Create" class="alert-link">İlk etkinliği oluşturmak için tıklayın.</a>
            }
        </div>
    }
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
}

